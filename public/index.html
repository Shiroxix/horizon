<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horizon Command Center | Ultra Update</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --primary: #00f2ff; --accent: #bc13fe; --bg: #020408; 
            --card: #0d121d; --text: #f8fafc; --success: #00ff88; --danger: #ff4655;
            --border: rgba(255, 255, 255, 0.1); --glass: rgba(15, 23, 42, 0.8);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); overflow-x: hidden; scroll-behavior: smooth; }

        /* --- LOGIN SCREEN --- */
        #authScreen { position: fixed; inset: 0; z-index: 9999; background: var(--bg); display: flex; align-items: center; justify-content: center; backdrop-filter: blur(20px); }
        .auth-card { background: var(--card); border: 1px solid var(--border); padding: 40px; border-radius: 30px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 0 50px rgba(0,242,255,0.1); }
        .input-cyber { width: 100%; background: #000; border: 1px solid var(--border); padding: 15px; border-radius: 12px; color: #fff; margin-bottom: 15px; font-weight: 600; }
        .btn-main { width: 100%; padding: 15px; border-radius: 12px; border: none; background: linear-gradient(90deg, var(--accent), var(--primary)); color: #000; font-weight: 900; cursor: pointer; text-transform: uppercase; }

        /* --- HEADER & NAV --- */
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 5%; background: var(--glass); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
        .logo { font-family: 'Rajdhani'; font-size: 1.8rem; font-weight: 700; color: var(--primary); letter-spacing: 3px; }
        
        /* --- DASHBOARD --- */
        .container { max-width: 1400px; margin: auto; padding: 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .card-p { background: var(--card); border-radius: 20px; padding: 20px; border: 1px solid var(--border); transition: 0.3s; position: relative; overflow: hidden; }
        .card-p:hover { border-color: var(--primary); transform: translateY(-5px); }
        
        .trophy-gain { font-size: 0.8rem; font-weight: 900; padding: 4px 8px; border-radius: 6px; background: rgba(0,255,136,0.1); color: var(--success); }

        /* --- MODAL PERFIL (SLAA STYLE) --- */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; overflow-y: auto; padding: 15px; }
        .modal-content { max-width: 1100px; margin: 40px auto; background: var(--card); border: 1px solid var(--border); border-radius: 30px; padding: 30px; animation: slideUp 0.4s ease; }
        
        .brawler-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; margin-top: 20px; }
        .b-card { background: rgba(255,255,255,0.03); border-radius: 15px; padding: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .b-card:hover { background: rgba(0,242,255,0.05); border-color: var(--primary); }

        /* --- ADMIN PANEL --- */
        .log-box { background: #000; border: 1px solid var(--accent); border-radius: 10px; height: 300px; overflow-y: auto; padding: 15px; font-family: monospace; font-size: 0.8rem; }
        .log-line { border-bottom: 1px solid #111; padding: 5px 0; display: flex; justify-content: space-between; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 768px) {
            .logo { font-size: 1.4rem; }
            .modal-content { padding: 20px; margin: 10px auto; }
        }
    </style>
</head>
<body>

    <div id="authScreen">
        <div class="auth-card">
            <h1 class="logo" style="margin-bottom: 30px;">HORIZON ACCESS</h1>
            <input type="text" id="userInput" class="input-cyber" placeholder="NOME DE USU√ÅRIO">
            <input type="password" id="passInput" class="input-cyber" placeholder="SENHA">
            <button class="btn-main" onclick="handleLogin()">Entrar</button>
            <p id="errorMsg" style="color:var(--danger); font-size:0.8rem; margin-top:10px; display:none;">Credenciais Inv√°lidas</p>
        </div>
    </div>

    <div id="app" style="display:none;">
        <header>
            <div class="logo">HORIZON <span style="color:#fff">ANALYTICS</span></div>
            <div style="display:flex; gap:15px; align-items:center;">
                <i id="admGear" class="fas fa-cog" style="display:none; cursor:pointer; font-size:1.2rem; color:var(--primary)" onclick="openAdm()"></i>
                <div id="userBadge" style="font-weight:900; font-size:0.9rem; text-transform:uppercase;">-</div>
                <button onclick="logout()" style="background:none; border:none; color:var(--danger); font-weight:bold; cursor:pointer;">SAIR</button>
            </div>
        </header>

        <div class="container">
            <div style="margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center;">
                <h2>MEMBROS DO CLUBE</h2>
                <div id="syncTime" style="font-size:0.7rem; color:#64748b;">SINCRONIZADO AGORA</div>
            </div>
            <div class="stats-grid" id="memberList">
                </div>
        </div>
    </div>

    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
                <h1 id="pName" style="font-family:'Rajdhani'; font-size:2.5rem; color:var(--primary);">-</h1>
                <button onclick="closeModal()" style="background:none; border:none; color:#fff; font-size:2rem; cursor:pointer;">&times;</button>
            </div>

            <div class="stats-grid" style="margin-bottom:30px;">
                <div class="card-p">
                    <p style="font-size:0.7rem; color:#64748b;">VIT√ìRIAS 3V3</p>
                    <h2 id="p3v3" style="color:var(--primary)">0</h2>
                </div>
                <div class="card-p">
                    <p style="font-size:0.7rem; color:#64748b;">TROF√âUS M√ÅXIMOS</p>
                    <h2 id="pMax" style="color:#ffd700">0</h2>
                </div>
            </div>

            <div style="margin-top:40px;">
                <h3>COLE√á√ÉO DE BRAWLERS</h3>
                <div class="brawler-grid" id="pBrawlers"></div>
            </div>
        </div>
    </div>

    <div id="admModal" class="modal">
        <div class="modal-content" style="max-width:700px;">
            <h2 style="color:var(--accent); font-family:'Rajdhani'; margin-bottom:20px;">SISTEMA DE LOGS DO SERVIDOR</h2>
            <div class="log-box" id="logItems"></div>
            <button class="btn-main" style="margin-top:20px; background:var(--danger);" onclick="closeAdm()">FECHAR PAINEL</button>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ïES
        const ADM_USER = "shiro";
        const ADM_PASS = "18172220";
        let currentUser = null;
        let initialTrophies = JSON.parse(localStorage.getItem('hz_start_trophies') || '{}');

        // 1. SISTEMA DE LOGIN E LOGS
        async function handleLogin() {
            const u = document.getElementById('userInput').value;
            const p = document.getElementById('passInput').value;

            if (u === ADM_USER && p === ADM_PASS) {
                const ipRes = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipRes.json();
                
                currentUser = { name: u, isAdm: true, ip: ipData.ip };
                saveLog(u, ipData.ip);
                localStorage.setItem('hz_user', JSON.stringify(currentUser));
                startApp();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }

        function saveLog(user, ip) {
            let logs = JSON.parse(localStorage.getItem('hz_server_logs') || '[]');
            logs.unshift({
                user: user,
                ip: ip,
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString()
            });
            localStorage.setItem('hz_server_logs', JSON.stringify(logs.slice(0, 100)));
        }

        // 2. INICIALIZA√á√ÉO DO APP
        window.onload = () => {
            const saved = localStorage.getItem('hz_user');
            if(saved) {
                currentUser = JSON.parse(saved);
                startApp();
            }
        };

        function startApp() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('userBadge').innerText = currentUser.name;
            if(currentUser.isAdm) document.getElementById('admGear').style.display = 'block';
            loadClubData();
        }

        async function loadClubData() {
            try {
                const res = await fetch('/api/stats');
                const data = await res.json();
                const container = document.getElementById('memberList');
                
                container.innerHTML = data.club.members.sort((a,b) => b.trophies - a.trophies).map(m => {
                    const gain = m.trophies - (initialTrophies[m.tag] || m.trophies);
                    // Salva trof√©us iniciais se n√£o existirem
                    if(!initialTrophies[m.tag]) initialTrophies[m.tag] = m.trophies;
                    
                    return `
                        <div class="card-p" onclick="openProfile('${m.tag}')">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div>
                                    <h3 style="font-family:'Rajdhani'">${m.name}</h3>
                                    <p style="font-size:0.6rem; color:#64748b;">${m.tag}</p>
                                </div>
                                <div style="text-align:right;">
                                    <div style="font-weight:900; color:var(--primary); font-size:1.2rem;">${m.trophies.toLocaleString()}</div>
                                    <div class="trophy-gain">${gain >= 0 ? '+' : ''}${gain} 24h</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                localStorage.setItem('hz_start_trophies', JSON.stringify(initialTrophies));
            } catch(e) { console.error("Erro API"); }
        }

        // 3. PERFIL DETALHADO E BRAWLERS
        async function openProfile(tag) {
            document.getElementById('profileModal').style.display = 'block';
            try {
                const res = await fetch(`/api/player/${tag.replace('#', '%23')}`);
                const p = await res.json();
                
                document.getElementById('pName').innerText = p.name;
                document.getElementById('p3v3').innerText = p['3vs3Victories'].toLocaleString();
                document.getElementById('pMax').innerText = p.highestTrophies.toLocaleString();

                const bContainer = document.getElementById('pBrawlers');
                bContainer.innerHTML = p.brawlers.map(b => `
                    <div class="b-card">
                        <div style="font-size:0.6rem; color:var(--primary); font-weight:bold;">POWER ${b.power}</div>
                        <div style="font-weight:900; margin:10px 0;">${b.name.toUpperCase()}</div>
                        <div style="color:var(--success); font-size:0.8rem;">üèÜ ${b.trophies}</div>
                    </div>
                `).join('');
            } catch(e) { alert("Erro ao carregar dados do jogador"); }
        }

        // 4. ADMIN E LOGS
        function openAdm() {
            document.getElementById('admModal').style.display = 'block';
            const logs = JSON.parse(localStorage.getItem('hz_server_logs') || '[]');
            document.getElementById('logItems').innerHTML = logs.map(l => `
                <div class="log-line">
                    <span><b>${l.user}</b> (${l.ip})</span>
                    <span style="color:#64748b;">${l.date} - ${l.time}</span>
                </div>
            `).join('');
        }

        function logout() {
            localStorage.removeItem('hz_user');
            location.reload();
        }

        function closeModal() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
        function closeAdm() { document.getElementById('admModal').style.display = 'none'; }
    </script>
</body>
</html>
