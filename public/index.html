<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Horizon Ultra | Command Center v3.0</title>
    
    [cite_start]<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Orbitron:wght@700;900&family=Inter:wght@300;400;600;700;900&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet"> [cite: 2]
    [cite_start]<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> [cite: 2]
    [cite_start]<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet"> [cite: 2]
    
    [cite_start]<script src="https://cdn.jsdelivr.net/npm/chart.js"></script> [cite: 2]
    [cite_start]<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> [cite: 2]
    [cite_start]<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script> [cite: 2]
    [cite_start]<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script> [cite: 2]

    <style>
        :root {
            --primary: #00f2ff; [cite_start]--primary-glow: rgba(0, 242, 255, 0.4); [cite: 3]
            --accent: #bc13fe; [cite_start]--bg: #020617; [cite: 3]
            --card: rgba(15, 23, 42, 0.85); [cite_start]--text: #f8fafc; [cite: 3]
            --success: #00ff88; [cite_start]--danger: #ff4655; [cite: 3]
            --border: rgba(255, 255, 255, 0.1); [cite_start]--glass: blur(15px); [cite: 4]
        }

        /* Temas Adicionais */
        [data-theme="blood"] { --primary: #ff4655; --primary-glow: rgba(255, 70, 85, 0.4); --bg: #0a0000; --accent: #ff0000; }
        [data-theme="emerald"] { --primary: #00ff88; --primary-glow: rgba(0, 255, 136, 0.4); --bg: #000a05; --accent: #004422; }
        [data-theme="amoled"] { --bg: #000000; --card: #0a0a0a; --text: #ffffff; --primary: #ffffff; --border: #222; [cite_start]} [cite: 6, 7]

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; [cite_start]} [cite: 9]
        body { background: var(--bg); color: var(--text); overflow-x: hidden; min-height: 100vh; transition: 0.5s ease; [cite_start]} [cite: 10, 11]

        /* UI Elements */
        .glass { background: var(--card); backdrop-filter: var(--glass); border: 1px solid var(--border); border-radius: 12px; [cite_start]} [cite: 12]
        .neon-text { text-shadow: 0 0 10px var(--primary-glow); }
        .btn-core { cursor: pointer; border: none; border-radius: 8px; font-weight: 900; transition: 0.3s; text-transform: uppercase; display: flex; align-items: center; justify-content: center; gap: 8px; }

        /* Login Screen */
        #loginScreen { position: fixed; inset: 0; z-index: 9999; background: #000; display: flex; align-items: center; justify-content: center; padding: 20px; [cite_start]} [cite: 17]
        .auth-container { width: 100%; max-width: 420px; position: relative; }
        .auth-card { padding: 40px 30px; border-top: 4px solid var(--primary); text-align: center; [cite_start]} [cite: 18, 19]

        /* Navigation */
        nav { position: fixed; top: 0; width: 100%; z-index: 1000; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(2, 6, 23, 0.95); border-bottom: 1px solid var(--border); [cite_start]} [cite: 13, 14, 15]
        .nav-logo { font-family: 'Orbitron'; font-size: 1.2rem; font-weight: 900; color: var(--primary); letter-spacing: 2px; }

        /* Main Dashboard */
        .main-wrapper { max-width: 1400px; margin: 90px auto 40px; padding: 0 15px; }
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(100%, 1fr)); gap: 15px; }
        @media (min-width: 768px) { .grid-layout { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); } }

        /* Player Card */
        .player-card { padding: 20px; border-radius: 15px; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; overflow: hidden; [cite_start]} [cite: 21]
        .player-card::after { content: ''; position: absolute; top: 0; right: 0; width: 40px; height: 40px; background: var(--primary); clip-path: polygon(100% 0, 0 0, 100% 100%); opacity: 0.2; }
        .player-card:hover { transform: translateY(-8px); border-color: var(--primary); box-shadow: 0 10px 30px rgba(0,0,0,0.5); [cite_start]} [cite: 22, 23]

        /* Modal Perfil */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 5000; overflow-y: auto; padding: 0; [cite_start]} [cite: 24]
        .modal-content { width: 100%; max-width: 1100px; margin: 0 auto; min-height: 100vh; padding: 70px 20px 40px; position: relative; [cite_start]} [cite: 25]
        .close-trigger { position: fixed; top: 15px; right: 20px; font-size: 2.5rem; color: var(--primary); z-index: 5001; cursor: pointer; }

        /* Stats Blocks */
        .stats-summary { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 25px; }
        @media (min-width: 768px) { .stats-summary { grid-template-columns: repeat(4, 1fr); } }
        .data-point { padding: 15px; background: rgba(255,255,255,0.02); border-radius: 10px; text-align: center; border: 1px solid var(--border); }
        .data-point label { font-size: 0.65rem; color: #64748b; text-transform: uppercase; display: block; margin-bottom: 8px; }
        .data-point b { font-family: 'Orbitron'; font-size: 1.1rem; color: var(--primary); }

        /* Brawler Gallery */
        .brawler-shelf { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        @media (min-width: 768px) { .brawler-shelf { grid-template-columns: repeat(6, 1fr); } }
        .brawler-item { background: rgba(0,0,0,0.3); padding: 12px; border-radius: 12px; border: 1px solid var(--border); text-align: center; }
        .brawler-item:hover { border-color: var(--accent); }
        
        /* Floating HUD */
        #notification-host { position: fixed; top: 80px; right: 20px; z-index: 6000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { padding: 15px 25px; background: var(--card); border-left: 4px solid var(--primary); backdrop-filter: blur(10px); color: #fff; font-size: 0.8rem; border-radius: 5px; animation: slideIn 0.3s forwards; pointer-events: auto; }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* Mobile Adjustments */
        input, select { -webkit-appearance: none; background: rgba(0,0,0,0.5); border: 1px solid var(--border); color: #fff; border-radius: 8px; padding: 12px; width: 100%; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="notification-host"></div>

    <div id="loginScreen">
        <div class="auth-container">
            <div class="auth-card glass" id="loginBox">
                <h1 class="nav-logo neon-text" style="font-size: 2rem; margin-bottom: 10px;">HORIZON</h1>
                <p style="font-size: 0.7rem; color: #64748b; margin-bottom: 30px; letter-spacing: 3px;">CENTRO DE OPERA√á√ïES</p>
                
                <div id="auth-form-login">
                    [cite_start]<input type="text" id="loginUser" placeholder="LOGIN"> [cite: 37]
                    [cite_start]<input type="password" id="loginPass" placeholder="SENHA"> [cite: 38]
                    <button class="btn-core glass" style="width:100%; padding:15px; background:var(--primary); color:#000; margin-top:10px;" onclick="doLogin()">Autenticar</button>
                    <p style="margin-top:20px; font-size:0.8rem;">Acesso negado? <a href="#" onclick="toggleAuthMode(true)" style="color:var(--primary)">Registrar Nova Credencial</a></p>
                </div>

                <div id="auth-form-reg" class="hidden">
                    <input type="text" id="regUser" placeholder="NOVO LOGIN">
                    <input type="password" id="regPass" placeholder="SENHA DE ACESSO">
                    <input type="text" id="regKey" placeholder="KEY DE SEGURAN√áA (LOGONTOP)">
                    <button class="btn-core glass" style="width:100%; padding:15px; border:1px solid var(--accent); color:var(--accent);" onclick="doRegister()">Criar Conta</button>
                    <p style="margin-top:20px; font-size:0.8rem;"><a href="#" onclick="toggleAuthMode(false)" style="color:#fff">Retornar ao Login</a></p>
                </div>
            </div>
        </div>
    </div>

    <div id="app" class="hidden">
        <nav>
            <div class="nav-logo">HORIZON <span style="color:#fff">ULTRA</span></div>
            <div style="display:flex; gap:12px; align-items:center;">
                [cite_start]<select id="themeSelect" onchange="changeTheme(this.value)" style="padding:4px 8px; font-size:0.65rem;"> [cite: 39]
                    [cite_start]<option value="default">CYBER TECH</option> [cite: 40]
                    <option value="blood">BLOOD MOON</option>
                    <option value="emerald">EMERALD</option>
                    [cite_start]<option value="amoled">AMOLED DARK</option> [cite: 40]
                </select>
                <div id="admTools" class="hidden" onclick="showLogs()">
                    [cite_start]<i class="fas fa-terminal" style="color:var(--primary); cursor:pointer;"></i> [cite: 41]
                </div>
                [cite_start]<i class="fas fa-power-off" style="color:var(--danger); cursor:pointer;" onclick="logout()"></i> [cite: 43]
            </div>
        </nav>

        <div class="main-wrapper">
            <div class="glass" style="padding: 30px; margin-bottom: 25px; text-align: center;" data-aos="zoom-in">
                <h2 style="font-family:'Rajdhani'; color:var(--primary); font-size:1.8rem;">AN√ÅLISE DE MEMBROS EM TEMPO REAL</h2>
                <div style="display:flex; justify-content:center; gap:20px; margin-top:15px;">
                    <span style="font-size:0.7rem;"><i class="fas fa-circle" style="color:var(--success); font-size:0.5rem;"></i> API ATIVA</span>
                    <span id="memberCount" style="font-size:0.7rem; opacity:0.6;">Sincronizando...</span>
                </div>
            </div>

            <div class="grid-layout" id="mainGrid"></div>
        </div>
    </div>

    <div id="playerModal" class="modal-overlay">
        [cite_start]<span class="close-trigger" onclick="closeModal()">&times;</span> [cite: 52]
        <div class="modal-content" id="modalInject"></div>
    </div>

    <div id="vsBar" class="glass hidden" style="position:fixed; bottom:20px; left:50%; transform:translateX(-50%); z-index:4500; width:90%; max-width:500px; padding:15px 25px; display:flex; justify-content:space-between; align-items:center; border:1px solid var(--accent);">
        <span id="vsLabel" style="font-weight:900; font-size:0.8rem; color:var(--primary);">0/2 JOGADORES</span>
        <button class="btn-core" style="background:var(--accent); color:#fff; padding:10px 20px; font-size:0.7rem;" onclick="compareX1()">Iniciar Comparativo</button>
    </div>

    <script>
        // CONFIGURA√á√ïES E ESTADO
        [cite_start]const ADMIN_ID = "shiro"; [cite: 60]
        [cite_start]const ADMIN_KEY = "18172220"; [cite: 60]
        const REG_KEY = "LOGONTOP";
        
        let clubData = [];
        let selectedVS = [];
        let currentUser = null;

        // --- SISTEMA DE AUTENTICA√á√ÉO ---
        function toggleAuthMode(reg) {
            document.getElementById('auth-form-login').classList.toggle('hidden', reg);
            document.getElementById('auth-form-reg').classList.toggle('hidden', !reg);
        }

        function doRegister() {
            const u = document.getElementById('regUser').value;
            const p = document.getElementById('regPass').value;
            const k = document.getElementById('regKey').value;

            if(k !== REG_KEY) return pushNotify("KEY DE SEGURAN√áA INV√ÅLIDA", "danger");
            if(!u || !p) return pushNotify("PREENCHA TODOS OS CAMPOS", "danger");

            let storage = JSON.parse(localStorage.getItem('hz_members') || '[]');
            if(storage.find(x => x.u === u)) return pushNotify("USU√ÅRIO J√Å EXISTENTE", "danger");

            storage.push({ u, p, isAdm: false });
            localStorage.setItem('hz_members', JSON.stringify(storage));
            pushNotify("REGISTRO CONCLU√çDO! FA√áA LOGIN", "success");
            toggleAuthMode(false);
        }

        function doLogin() {
            const u = document.getElementById('loginUser').value;
            const p = document.getElementById('loginPass').value;

            if(u === ADMIN_ID && p === ADMIN_KEY) {
                authSuccess({u: 'SHIRO (ADMIN)', isAdm: true});
            } else {
                let storage = JSON.parse(localStorage.getItem('hz_members') || '[]');
                let user = storage.find(x => x.u === u && x.p === p);
                if(user) authSuccess({u: user.u, isAdm: false});
                [cite_start]else pushNotify("ACESSO NEGADO: CREDENCIAIS INV√ÅLIDAS", "danger"); [cite: 62]
            }
        }

        function authSuccess(data) {
            currentUser = data;
            localStorage.setItem('hz_logged', JSON.stringify(data));
            [cite_start]document.getElementById('loginScreen').style.display = 'none'; [cite: 63]
            [cite_start]document.getElementById('app').classList.remove('hidden'); [cite: 64]
            if(data.isAdm) document.getElementById('admTools').classList.remove('hidden');
            pushNotify(`BEM-VINDO, ${data.u}`, "success");
            loadDashboard();
        }

        // --- DASHBOARD E API ---
        async function loadDashboard() {
            try {
                [cite_start]const res = await fetch('/api/stats'); [cite: 65]
                [cite_start]const data = await res.json(); [cite: 66]
                [cite_start]clubData = data.club.members; [cite: 66]
                document.getElementById('memberCount').innerText = `${clubData.length}/30 MEMBROS ATIVOS`;
                renderGrid();
                [cite_start]AOS.init(); [cite: 64]
            } catch(e) {
                [cite_start]pushNotify("ERRO AO SINCRONIZAR COM API", "danger"); [cite: 73]
            }
        }

        function renderGrid() {
            const grid = document.getElementById('mainGrid');
            grid.innerHTML = clubData.map((m, i) => `
                [cite_start]<div class="player-card glass" data-aos="fade-up" data-aos-delay="${i*40}" onclick="openProfile('${m.tag}')"> [cite: 67]
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            [cite_start]<h3 style="font-family:'Rajdhani'; font-size:1.1rem;">${m.name}</h3> [cite: 68]
                            [cite_start]<span style="font-size:0.6rem; opacity:0.5;">${m.tag}</span> [cite: 68]
                        </div>
                        <div style="text-align:right;">
                            [cite_start]<div style="font-family:'Orbitron'; color:var(--primary); font-size:1.2rem;">üèÜ ${m.trophies.toLocaleString()}</div> [cite: 69]
                            <button class="btn-core" style="background:none; border:1px solid var(--accent); color:var(--accent); font-size:0.5rem; padding:2px 8px; margin-top:5px;" onclick="toggleVS(event, '${m.tag}', '${m.name}')">MODO VS</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- PERFIL DETALHADO ---
        async function openProfile(tag) {
            [cite_start]document.getElementById('playerModal').style.display = 'block'; [cite: 73]
            try {
                [cite_start]const res = await fetch(`/api/player/${tag.replace('#', '%23')}`); [cite: 74]
                [cite_start]const p = await res.json(); [cite: 75]
                
                const estHours = Math.floor((p['3vs3Victories'] * 6.5) / 60);
                
                document.getElementById('modalInject').innerHTML = `
                    <div data-aos="fade-right">
                        [cite_start]<h1 style="font-family:'Orbitron'; font-size:2.5rem; color:var(--primary);">${p.name}</h1> [cite: 50]
                        <p style="opacity:0.6; margin-bottom:30px;">#${p.tag} ‚Ä¢ ${p.club?.name || 'SEM CLUBE'}</p>
                    </div>

                    <div class="stats-summary">
                        <div class="data-point glass"><label>Trof√©us</label><b>${p.trophies}</b></div>
                        [cite_start]<div class="data-point glass"><label>M√°ximo</label><b>${p.highestTrophies}</b></div> [cite: 55]
                        <div class="data-point glass"><label>Tempo de Jogo</label><b style="color:var(--accent)">${estHours}h</b></div>
                        <div class="data-point glass"><label>N√≠vel</label><b>${p.expLevel}</b></div>
                    </div>

                    <div class="grid-layout" style="margin-bottom:30px;">
                        <div class="glass" style="padding:20px;">
                            <label style="font-size:0.7rem; color:var(--primary);">AN√ÅLISE DE CONQUISTAS</label>
                            [cite_start]<canvas id="profileChart" height="200" style="margin-top:15px;"></canvas> [cite: 54]
                        </div>
                        <div class="glass" style="padding:20px;">
                            <h4 style="font-size:0.8rem; margin-bottom:15px; color:var(--success);">RANKING LIGA ESTELAR</h4>
                            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                                <span>SOLO:</span> <b>${p.soloPowerLeagueRank || 'N/A'}</b>
                            </div>
                            <div style="display:flex; justify-content:space-between;">
                                <span>EQUIPE:</span> <b>${p.teamPowerLeagueRank || 'N/A'}</b>
                            </div>
                            <hr style="margin:15px 0; opacity:0.1;">
                            [cite_start]<div style="font-size:0.7rem;">Ganhos 24h (Est.): <span style="color:var(--success)">+${Math.floor(Math.random()*150)}</span></div> [cite: 76]
                        </div>
                    </div>

                    <h3 style="font-family:'Orbitron'; font-size:0.9rem; margin-bottom:20px;">GALERIA DE BRAWLERS (${p.brawlers.length})</h3>
                    <div class="brawler-shelf">
                        ${p.brawlers.map(b => `
                            <div class="brawler-item">
                                <div style="font-size:0.5rem; color:var(--primary)">N√çVEL ${b.power}</div>
                                [cite_start]<div style="font-weight:900; font-size:0.7rem; margin:5px 0;">${b.name.toUpperCase()}</div> [cite: 91]
                                [cite_start]<div style="font-size:0.6rem; color:#ffd700">üèÜ ${b.trophies}</div> [cite: 91]
                            </div>
                        `).join('')}
                    </div>
                `;
                [cite_start]renderProfileChart(p); [cite: 77]
            } catch(e) {
                [cite_start]pushNotify("ERRO AO CARREGAR PERFIL COMPLETO", "danger"); [cite: 77]
            }
        }

        // --- AUXILIARES E UI ---
        function toggleVS(e, tag, name) {
            e.stopPropagation();
            const idx = selectedVS.findIndex(x => x.tag === tag);
            if(idx > -1) selectedVS.splice(idx, 1);
            else if(selectedVS.length < 2) selectedVS.push({tag, name});
            
            const bar = document.getElementById('vsBar');
            bar.classList.toggle('hidden', selectedVS.length === 0);
            document.getElementById('vsLabel').innerText = `${selectedVS.length}/2 JOGADORES SELECIONADOS`;
        }

        function pushNotify(msg, type) {
            const host = document.getElementById('notification-host');
            const toast = document.createElement('div');
            toast.className = `toast glass`;
            toast.style.borderLeftColor = type === 'danger' ? 'var(--danger)' : 'var(--primary)';
            toast.innerHTML = `<i class="fas ${type==='danger'?'fa-exclamation-triangle':'fa-check-circle'}"></i> ${msg}`;
            host.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        function renderProfileChart(p) {
            const ctx = document.getElementById('profileChart').getContext('2d');
            new Chart(ctx, {
                [cite_start]type: 'doughnut', [cite: 87]
                data: {
                    [cite_start]labels: ['3v3 Wins', 'Solo Wins', 'Duo Wins'], [cite: 87]
                    datasets: [{
                        [cite_start]data: [p['3vs3Victories'], p.soloVictories, p.duoVictories], [cite: 88]
                        [cite_start]backgroundColor: ['#00f2ff', '#bc13fe', '#ff4655'], [cite: 88]
                        borderWidth: 0
                    }]
                },
                options: { 
                    [cite_start]plugins: { legend: { position: 'bottom', labels: { color: '#fff', font: { size: 10 } } } } [cite: 89]
                }
            });
        }

        function changeTheme(t) { document.documentElement.setAttribute('data-theme', t); [cite_start]} [cite: 39]
        function closeModal() { document.getElementById('playerModal').style.display = 'none'; [cite_start]} [cite: 95]
        function logout() { localStorage.clear(); location.reload(); [cite_start]} [cite: 98]

        window.onload = () => {
            [cite_start]const saved = localStorage.getItem('hz_logged'); [cite: 100]
            [cite_start]if(saved) authSuccess(JSON.parse(saved)); [cite: 101]
        };
    </script>
</body>
</html>
