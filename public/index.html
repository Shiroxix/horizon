<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horizon Command | Tactical Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --primary: #00f2ff; --accent: #bc13fe; --bg: #05070a; 
            --card: #11161d; --text: #f0f0f0; --success: #00ff88; --danger: #ff4655;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }

        /* AUTH SCREEN */
        #authScreen { position: fixed; inset: 0; z-index: 9999; background: var(--bg); display: flex; align-items: center; justify-content: center; }
        .auth-card { background: var(--card); padding: 40px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); width: 100%; max-width: 400px; text-align: center; }
        
        /* HEADER & NAV */
        header { display: flex; justify-content: space-between; align-items: center; padding: 30px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .logo { font-family: 'Rajdhani'; font-size: 2rem; color: var(--primary); letter-spacing: 4px; }
        .user-nav { display: flex; align-items: center; gap: 15px; cursor: pointer; }

        /* DASHBOARD GRID */
        .container { max-width: 1400px; margin: auto; padding: 20px; }
        .member-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .p-card { background: var(--card); border-radius: 20px; padding: 25px; border: 1px solid rgba(255,255,255,0.03); cursor: pointer; transition: 0.3s; position: relative; }
        .p-card:hover { border-color: var(--primary); transform: translateY(-5px); }

        /* MODAL / ABA DE PERFIL (ESTILO SLAA.HTML) */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; overflow-y: auto; padding: 40px 20px; }
        .modal-content { max-width: 1000px; margin: auto; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 30px; padding: 30px; }
        
        .brawler-card { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; }
        
        .btn-cyber { background: var(--primary); color: #000; border: none; padding: 12px; border-radius: 10px; font-weight: 800; cursor: pointer; width: 100%; margin-top: 10px; font-family: 'Rajdhani'; }

        .input-cyber { width: 100%; padding: 15px; background: #000; border: 1px solid #333; color: #fff; border-radius: 12px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="authScreen">
        <div class="auth-card">
            <h1 class="logo" style="margin-bottom: 20px;">HORIZON</h1>
            <input type="text" id="userIn" class="input-cyber" placeholder="USU√ÅRIO">
            <input type="password" id="passIn" class="input-cyber" placeholder="SENHA">
            <button class="btn-cyber" onclick="login()">ACESSAR SISTEMA</button>
            <p onclick="toggleAuth()" style="font-size: 0.8rem; margin-top: 15px; cursor: pointer; opacity: 0.6;">Registrar novo ID</p>
        </div>
    </div>

    <div id="mainContent" style="display:none;">
        <header>
            <h1 class="logo">HORIZON PRO</h1>
            <div class="user-nav" onclick="openMyProfile()">
                <div style="text-align: right;">
                    <div id="navName" style="font-weight: 900; color: var(--primary);">USU√ÅRIO</div>
                    <div id="navID" style="font-size: 0.7rem; color: #64748b;">ID: ------</div>
                </div>
                <i class="fas fa-user-circle text-3xl" style="font-size: 2rem;"></i>
            </div>
        </header>

        <div class="container">
            <div class="member-grid" id="memberList">
                </div>
        </div>
    </div>

    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="glass-panel">
                <div class="flex justify-between items-center mb-8" style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 id="p-name" style="font-size: 2.5rem; font-weight: 900; color: #ffd700;">NOME DO JOGADOR</h1>
                        <p id="p-tag" style="color: var(--primary); letter-spacing: 2px;">#TAG0000</p>
                    </div>
                    <button onclick="closeModal()" style="background: none; border: none; color: #fff; font-size: 2rem; cursor: pointer;">&times;</button>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="glass-panel" style="padding: 20px; text-align: center;">
                        <p style="font-size: 0.7rem; color: #64748b;">TROF√âUS ATUAIS</p>
                        <h2 id="p-trophies" style="font-size: 2rem; font-family: 'Rajdhani'; color: #ffd700;">0</h2>
                    </div>
                    <div class="glass-panel" style="padding: 20px; text-align: center;">
                        <p style="font-size: 0.7rem; color: #64748b;">RECORDES</p>
                        <h2 id="p-high" style="font-size: 2rem; font-family: 'Rajdhani'; color: var(--danger);">0</h2>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px;">
                    <div class="glass-panel">
                        <h3 style="margin-bottom: 20px; font-size: 0.8rem;">VIT√ìRIAS</h3>
                        <canvas id="winChart"></canvas>
                    </div>
                    <div class="glass-panel">
                        <h3 style="margin-bottom: 20px; font-size: 0.8rem;">BRAWLERS EM DESTAQUE</h3>
                        <div id="brawlerList" style="display: flex; flex-direction: column; gap: 10px;">
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let chartInstance = null;

        // 1. LOGIN E PERSIST√äNCIA
        async function login() {
            const u = document.getElementById('userIn').value;
            const p = document.getElementById('passIn').value;

            // Simula√ß√£o de login (pode conectar √† sua API de contas)
            if(u === 'shiro' && p === '18172220') {
                currentUser = { name: "Shiro", id: "MASTER-01", tag: "#C09YYR2U" };
                localStorage.setItem('hz_user', JSON.stringify(currentUser));
                initDashboard();
            } else {
                alert("Acesso negado.");
            }
        }

        window.onload = () => {
            const saved = localStorage.getItem('hz_user');
            if(saved) {
                currentUser = JSON.parse(saved);
                initDashboard();
            }
        };

        // 2. BUSCA DE DADOS DO CLUBE (API)
        async function initDashboard() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('navName').innerText = currentUser.name.toUpperCase();
            document.getElementById('navID').innerText = "ID: " + currentUser.id;

            try {
                const res = await fetch('/api/stats'); // Sua API de clube
                const data = await res.json();
                renderMembers(data.club.members);
            } catch (e) { console.error("Erro API Clube:", e); }
        }

        function renderMembers(members) {
            const list = document.getElementById('memberList');
            list.innerHTML = members.sort((a,b) => b.trophies - a.trophies).map(m => `
                <div class="p-card" onclick="openPlayerProfile('${m.tag}')">
                    <div style="display: flex; justify-content: space-between;">
                        <div>
                            <p style="font-family: 'Rajdhani'; font-size: 1.2rem; font-weight: 700;">${m.name}</p>
                            <p style="font-size: 0.6rem; color: #64748b;">${m.tag}</p>
                        </div>
                        <p style="font-family: 'Rajdhani'; font-weight: 900; color: var(--primary);">${m.trophies.toLocaleString()}</p>
                    </div>
                    <div style="height: 4px; background: rgba(255,255,255,0.05); margin-top: 15px; border-radius: 2px;">
                        <div style="width: ${(m.trophies/90000)*100}%; height: 100%; background: var(--primary);"></div>
                    </div>
                </div>
            `).join('');
        }

        // 3. BUSCA DE DADOS DO JOGADOR (API + VISUAL SLAA.HTML)
        async function openPlayerProfile(tag) {
            document.getElementById('profileModal').style.display = 'block';
            try {
                const res = await fetch(`/api/player/${tag.replace('#', '%23')}`); // Sua API de player
                const p = await res.json();
                
                document.getElementById('p-name').innerText = p.name;
                document.getElementById('p-tag').innerText = p.tag;
                document.getElementById('p-trophies').innerText = p.trophies.toLocaleString();
                document.getElementById('p-high').innerText = p.highestTrophies.toLocaleString();

                renderWinChart(p['3vs3Victories'], p.soloVictories, p.duoVictories);
                renderBrawlers(p.brawlers.slice(0, 4)); // Top 4 brawlers
            } catch (e) { console.error("Erro API Player:", e); }
        }

        function renderWinChart(v3, solo, duo) {
            const ctx = document.getElementById('winChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['3vs3', 'Solo', 'Duo'],
                    datasets: [{
                        data: [v3, solo, duo],
                        backgroundColor: ['#3b82f6', '#10b981', '#a855f7'],
                        borderWidth: 0
                    }]
                },
                options: { plugins: { legend: { position: 'bottom', labels: { color: '#fff' } } } }
            });
        }

        function renderBrawlers(brawlers) {
            const list = document.getElementById('brawlerList');
            list.innerHTML = brawlers.map(b => `
                <div class="brawler-card">
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <div style="background: #1e293b; padding: 5px 10px; border-radius: 8px; font-weight: 900; color: #ffd700;">${b.power}</div>
                        <div>
                            <p style="font-weight: 700; font-size: 0.9rem;">${b.name.toUpperCase()}</p>
                            <p style="font-size: 0.6rem; color: #64748b;">Rank ${b.rank}</p>
                        </div>
                    </div>
                    <p style="font-weight: 900; color: var(--success);">üèÜ ${b.trophies}</p>
                </div>
            `).join('');
        }

        function openMyProfile() { if(currentUser) openPlayerProfile(currentUser.tag); }
        function closeModal() { document.getElementById('profileModal').style.display = 'none'; }
    </script>
</body>
</html>
