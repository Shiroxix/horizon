<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HORIZON ULTRA | OS v7.0</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <style>
        :root {
            --primary: #00f2ff; --secondary: #7000ff; --accent: #ff007a;
            --bg: #020617; --card: rgba(15, 23, 42, 0.8);
            --border: rgba(0, 242, 255, 0.2); --text: #f8fafc;
            --font-t: 'Orbitron', sans-serif;
        }

        /* --- TEMAS --- */
        [data-theme="amoled"] { --bg: #000000; --card: #050505; --border: #1a1a1a; --primary: #ffffff; }
        [data-theme="neon"] { --bg: #050010; --primary: #00ff9f; --accent: #ff00ff; --border: #00ff9f; }
        [data-theme="blood"] { --bg: #0a0000; --primary: #ff4655; --accent: #990000; --border: #ff4655; }
        [data-theme="light"] { --bg: #f8fafc; --card: #ffffff; --text: #0f172a; --border: #e2e8f0; --primary: #2563eb; }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; 
            overflow-x: hidden; transition: 0.4s; min-height: 100vh;
        }

        /* Grid Background */
        body::before {
            content: ""; position: fixed; inset: 0; 
            background-image: linear-gradient(var(--border) 1px, transparent 1px), linear-gradient(90deg, var(--border) 1px, transparent 1px);
            background-size: 50px 50px; z-index: -1; opacity: 0.1;
        }

        /* --- AUTH --- */
        #authScreen { position: fixed; inset: 0; z-index: 9999; background: var(--bg); display: flex; align-items: center; justify-content: center; padding: 20px; }
        .glass-card { 
            background: var(--card); backdrop-filter: blur(20px); border: 1px solid var(--border);
            padding: 40px; border-radius: 24px; width: 100%; max-width: 420px; text-align: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        .tab-nav { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 12px; margin-bottom: 25px; }
        .tab-btn { padding: 10px; border: none; background: none; color: var(--text); font-family: var(--font-t); font-size: 0.7rem; cursor: pointer; border-radius: 8px; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: #000; }

        input { width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 12px; border: 1px solid var(--border); background: rgba(0,0,0,0.3); color: #fff; font-size: 1rem; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 15px var(--border); }

        /* --- DASHBOARD --- */
        nav { position: fixed; top: 0; width: 100%; z-index: 1000; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border); }
        .logo { font-family: var(--font-t); font-weight: 900; color: var(--primary); letter-spacing: 2px; }

        .content { max-width: 1400px; margin: 100px auto 40px; padding: 0 20px; }
        .player-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .card { 
            padding: 25px; border-radius: 20px; background: var(--card); border: 1px solid var(--border); 
            transition: 0.3s; cursor: pointer; position: relative; overflow: hidden;
        }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }

        /* --- X1 HUD --- */
        #x1Control { 
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); 
            z-index: 4000; display: none; background: var(--accent); color: #fff;
            padding: 15px 30px; border-radius: 50px; font-weight: 900; 
            font-family: var(--font-t); font-size: 0.8rem; cursor: pointer;
            box-shadow: 0 0 30px var(--accent);
        }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; inset: 0; z-index: 5000; background: var(--bg); overflow-y: auto; padding: 20px; }
        .m-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .close-icon { font-size: 2rem; color: var(--primary); cursor: pointer; }

        .stats-box { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 20px; border-radius: 15px; text-align: center; }
        .stats-box b { display: block; font-size: 1.5rem; color: var(--primary); font-family: var(--font-t); }

        /* Battle CSS */
        .vs-screen { display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: center; margin-top: 50px; }
        .vs-val { font-family: var(--font-t); font-size: 1.2rem; font-weight: 900; margin: 10px 0; }
        .win-glow { color: var(--primary); text-shadow: 0 0 15px var(--primary); }

        #toast { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); padding: 15px 30px; border-radius: 10px; background: var(--secondary); z-index: 10000; transition: 0.5s; font-weight: 800; }

        .hidden { display: none !important; }
    </style>
</head>
<body data-theme="default">

    <div id="toast">LOGGED IN</div>

    <div id="authScreen">
        <div class="glass-card" data-aos="zoom-in">
            <div class="logo" style="font-size: 2rem; margin-bottom: 5px;">HORIZON</div>
            <p style="font-size: 0.6rem; opacity: 0.5; letter-spacing: 5px; margin-bottom: 30px;">ULTRA COMMAND</p>
            
            <div class="tab-nav">
                <button class="tab-btn active" id="btn-l" onclick="setAuth('login')">LOGIN</button>
                <button class="tab-btn" id="btn-r" onclick="setAuth('reg')">REGISTRO</button>
            </div>

            <div id="auth-fields">
                <input type="text" id="uIn" placeholder="Usu√°rio">
                <input type="password" id="pIn" placeholder="Senha">
                <button onclick="handleAuth()" class="tab-btn active" style="width: 100%; padding: 15px; font-size: 0.9rem;">CONECTAR</button>
            </div>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <nav>
            <div class="logo">HORIZON <span style="color:var(--text)">7.0</span></div>
            <div style="display:flex; gap:15px; align-items:center;">
                <select onchange="document.body.setAttribute('data-theme', this.value)" style="background:none; color:var(--text); border:1px solid var(--border); padding:5px; border-radius:8px; font-size:0.7rem;">
                    <option value="default">CYBER</option>
                    <option value="amoled">AMOLED</option>
                    <option value="neon">NEON</option>
                    <option value="blood">BLOOD</option>
                    <option value="light">LIGHT</option>
                </select>
                <i class="fas fa-power-off" onclick="logout()" style="color:var(--accent); cursor:pointer;"></i>
            </div>
        </nav>

        <div class="content">
            <div style="display:flex; justify-content:space-between; margin-bottom:25px;">
                <h2 style="font-family: var(--font-t); font-size:0.8rem;">AN√ÅLISE DE MEMBROS</h2>
                <span id="pCount" style="color:var(--primary); font-size:0.7rem; font-weight:900;"></span>
            </div>
            <div class="player-grid" id="grid"></div>
        </div>
    </div>

    <div id="x1Control" onclick="openX1()">COMPARAR X1 (<span id="xCount">0</span>/2)</div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="m-header">
                <div id="mTitle"></div>
                <div class="close-icon" onclick="closeModal()">&times;</div>
            </div>
            <div id="mBody"></div>
        </div>
    </div>

    <script>
        AOS.init();
        let authMode = 'login';
        let selX1 = [];
        let clubCache = [];

        // --- AUTH LOGIC ---
        function setAuth(m) {
            authMode = m;
            document.getElementById('btn-l').classList.toggle('active', m === 'login');
            document.getElementById('btn-r').classList.toggle('active', m === 'reg');
        }

        function handleAuth() {
            const u = document.getElementById('uIn').value;
            const p = document.getElementById('pIn').value;
            if(!u || !p) return notify("PREENCHA OS CAMPOS");

            if(authMode === 'reg') {
                let users = JSON.parse(localStorage.getItem('hz_db') || '[]');
                if(users.find(x => x.u === u)) return notify("USU√ÅRIO J√Å EXISTE");
                users.push({u, p});
                localStorage.setItem('hz_db', JSON.stringify(users));
                notify("REGISTRADO! FA√áA LOGIN");
                setAuth('login');
            } else {
                let users = JSON.parse(localStorage.getItem('hz_db') || '[]');
                if((u === 'shiro' && p === '18172220') || users.find(x => x.u === u && x.p === p)) {
                    localStorage.setItem('hz_user', u);
                    init();
                } else notify("ACESSO NEGADO");
            }
        }

        // --- APP LOGIC ---
        async function init() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainApp').classList.remove('hidden');
            notify("SISTEMA ONLINE");
            
            const res = await fetch('/api/stats');
            const data = await res.json();
            clubCache = data.club.members;
            document.getElementById('pCount').innerText = `${clubCache.length} OPERADORES`;
            
            renderGrid();
        }

        function renderGrid() {
            document.getElementById('grid').innerHTML = clubCache.map((m, i) => `
                <div class="card" data-aos="fade-up" data-aos-delay="${i*30}" onclick="showPlayer('${m.tag}')">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <b style="font-family:var(--font-t); font-size:0.9rem;">${m.name}</b>
                            <p style="font-size:0.6rem; opacity:0.5;">${m.tag}</p>
                        </div>
                        <div style="text-align:right;">
                            <b style="color:var(--primary)">üèÜ ${m.trophies}</b>
                            <button onclick="addX1(event, '${m.tag}', '${m.name}')" style="display:block; margin-top:5px; background:none; border:1px solid var(--accent); color:var(--accent); padding:2px 8px; border-radius:4px; font-size:0.5rem; font-weight:900;">X1</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function showPlayer(tag) {
            const res = await fetch(`/api/player/${tag.replace('#', '%23')}`);
            const p = await res.json();
            document.getElementById('modal').style.display = 'block';
            document.getElementById('mTitle').innerHTML = `<h1 style="font-family:var(--font-t); color:var(--primary);">${p.name}</h1>`;
            
            document.getElementById('mBody').innerHTML = `
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:15px; margin-bottom:30px;">
                    <div class="stats-box"><b>${p.trophies}</b><small>ATUAL</small></div>
                    <div class="stats-box"><b>${p.highestTrophies}</b><small>RECORDE</small></div>
                    <div class="stats-box"><b>${p.expLevel}</b><small>N√çVEL</small></div>
                    <div class="stats-box"><b>${p.brawlers.length}</b><small>BRAWLERS</small></div>
                </div>

                <div style="background:rgba(0,0,0,0.2); padding:25px; border-radius:20px; border:1px solid var(--border); margin-bottom:30px;">
                    <h3 style="font-family:var(--font-t); font-size:0.7rem; margin-bottom:20px; color:var(--primary);">PROGRESS√ÉO 24H (ESTIMADA)</h3>
                    <canvas id="chart24" height="100"></canvas>
                </div>

                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:20px;">
                    <div class="stats-box" style="text-align:left;">
                        <h4 style="color:var(--primary); margin-bottom:10px;">VIT√ìRIAS</h4>
                        <div style="display:flex; justify-content:space-between;"><span>3 VS 3</span> <b>${p['3vs3Victories']}</b></div>
                        <div style="display:flex; justify-content:space-between;"><span>SOLO</span> <b>${p.soloVictories}</b></div>
                        <div style="display:flex; justify-content:space-between;"><span>DUO</span> <b>${p.duoVictories}</b></div>
                    </div>
                    <div class="stats-box">
                        <canvas id="radarSkill" height="200"></canvas>
                    </div>
                </div>
            `;

            renderCharts(p);
        }

        function addX1(e, tag, name) {
            e.stopPropagation();
            const exists = selX1.findIndex(x => x.tag === tag);
            if(exists > -1) selX1.splice(exists, 1);
            else if(selX1.length < 2) selX1.push({tag, name});
            
            document.getElementById('x1Control').style.display = selX1.length > 0 ? 'block' : 'none';
            document.getElementById('xCount').innerText = selX1.length;
        }

        async function openX1() {
            if(selX1.length < 2) return;
            document.getElementById('modal').style.display = 'block';
            document.getElementById('mTitle').innerHTML = `<h1 style="font-family:var(--font-t); color:var(--accent);">MODO BATALHA</h1>`;
            
            const [p1, p2] = await Promise.all(selX1.map(x => fetch(`/api/player/${x.tag.replace('#', '%23')}`).then(r => r.json())));
            
            const row = (label, v1, v2) => `
                <div style="text-align:center; font-size:0.6rem; opacity:0.4; margin-top:15px;">${label}</div>
                <div class="vs-screen">
                    <div class="vs-val ${v1 > v2 ? 'win-glow' : ''}">${v1}</div>
                    <div style="opacity:0.2;">|</div>
                    <div class="vs-val ${v2 > v1 ? 'win-glow' : ''}">${v2}</div>
                </div>
            `;

            document.getElementById('mBody').innerHTML = `
                <div class="vs-screen">
                    <h2 style="color:var(--primary)">${p1.name}</h2>
                    <span style="font-family:var(--font-t); color:var(--accent);">VS</span>
                    <h2 style="color:var(--primary)">${p2.name}</h2>
                </div>
                ${row("TROF√âUS TOTAIS", p1.trophies, p2.trophies)}
                ${row("VIT√ìRIAS 3V3", p1['3vs3Victories'], p2['3vs3Victories'])}
                ${row("BRAWLERS DESBLOQUEADOS", p1.brawlers.length, p2.brawlers.length)}
                ${row("M√âDIA TROF√âUS/BRAWLER", (p1.trophies/p1.brawlers.length).toFixed(0), (p2.trophies/p2.brawlers.length).toFixed(0))}
                
                <div class="stats-box" style="margin-top:40px; border-color:var(--accent);">
                    <p style="font-size:0.7rem;">VENCEDOR ANAL√çTICO</p>
                    <h1 style="font-family:var(--font-t); color:var(--accent);">${p1.trophies > p2.trophies ? p1.name : p2.name}</h1>
                </div>
            `;
        }

        function renderCharts(p) {
            new Chart(document.getElementById('chart24'), {
                type: 'line',
                data: { labels: ['00h','04h','08h','12h','16h','20h','24h'], datasets: [{ label: 'Trof√©us', data: [p.trophies-50, p.trophies-30, p.trophies-40, p.trophies-10, p.trophies+20, p.trophies+5, p.trophies], borderColor: '#00f2ff', tension: 0.4, fill: true, backgroundColor: 'rgba(0, 242, 255, 0.1)' }] },
                options: { plugins: { legend: { display: false } }, scales: { y: { grid: { color: 'rgba(255,255,255,0.05)' } }, x: { grid: { display: false } } } }
            });

            new Chart(document.getElementById('radarSkill'), {
                type: 'radar',
                data: { labels: ['3v3','Solo','Duo','Exp','Trophies'], datasets: [{ data: [p['3vs3Victories']/10, p.soloVictories, p.duoVictories, p.expLevel, p.trophies/100], borderColor: '#ff007a', backgroundColor: 'rgba(255, 0, 122, 0.2)' }] },
                options: { scales: { r: { grid: { color: 'rgba(255,255,255,0.1)' }, angleLines: { color: 'rgba(255,255,255,0.1)' }, ticks: { display: false } } }, plugins: { legend: { display: false } } }
            });
        }

        function notify(m) {
            const t = document.getElementById('toast');
            t.innerText = m; t.style.top = "20px";
            setTimeout(() => t.style.top = "-100px", 3000);
        }

        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        function logout() { localStorage.removeItem('hz_user'); location.reload(); }
        window.onload = () => { if(localStorage.getItem('hz_user')) init(); };
    </script>
</body>
</html>
