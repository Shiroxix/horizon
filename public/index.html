<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HORIZON ULTRA | Pro Elite v6.0</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;800&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <style>
        :root {
            --primary: #00f2ff; --secondary: #7000ff; --accent: #ff007a;
            --bg: #030712; --card-bg: rgba(20, 30, 50, 0.9);
            --border: rgba(0, 242, 255, 0.3); --text: #ffffff;
            --input-bg: rgba(255, 255, 255, 0.05);
        }

        /* --- SISTEMA DE TEMAS --- */
        [data-theme="amoled"] { --bg: #000000; --card-bg: #0a0a0a; --border: #1a1a1a; --primary: #ffffff; }
        [data-theme="neon"] { --bg: #000814; --primary: #ff00ff; --secondary: #00ffff; --border: #ff00ff; }
        [data-theme="light"] { --bg: #f3f4f6; --card-bg: #ffffff; --text: #111827; --border: #e5e7eb; --input-bg: #f9fafb; --primary: #2563eb; }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; transition: 0.3s; min-height: 100vh; }

        /* --- LOGIN --- */
        #authWrapper { position: fixed; inset: 0; z-index: 9999; background: var(--bg); display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { width: 100%; max-width: 400px; padding: 40px; border-radius: 24px; background: var(--card-bg); border: 1px solid var(--border); text-align: center; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .tab-group { display: flex; gap: 10px; margin-bottom: 25px; background: rgba(0,0,0,0.2); padding: 5px; border-radius: 12px; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: none; color: var(--text); opacity: 0.5; font-family: 'Orbitron'; font-size: 0.7rem; cursor: pointer; }
        .tab-btn.active { opacity: 1; background: var(--primary); color: #000; border-radius: 8px; }
        input { width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 12px; border: 2px solid var(--border); background: var(--input-bg); color: var(--text); }

        /* --- NAV --- */
        nav { position: fixed; top: 0; width: 100%; z-index: 1000; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: var(--card-bg); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border); }
        .logo { font-family: 'Orbitron'; color: var(--primary); font-weight: 900; }

        /* --- DASHBOARD --- */
        .container { max-width: 1400px; margin: 100px auto 40px; padding: 0 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .p-card { padding: 25px; border-radius: 20px; background: var(--card-bg); border: 1px solid var(--border); transition: 0.3s; cursor: pointer; position: relative; }
        .p-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .win-24h { position: absolute; top: 15px; right: 15px; font-size: 0.7rem; color: #00ff88; font-weight: 800; }

        /* --- X1 SYSTEM --- */
        #vsPanel { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 4000; width: 90%; max-width: 500px; padding: 15px; border-radius: 15px; display: none; align-items: center; justify-content: space-between; border: 2px solid var(--accent); }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; inset: 0; z-index: 5000; background: var(--bg); overflow-y: auto; padding: 20px; }
        .modal-content { max-width: 1000px; margin: 40px auto; }
        .close { position: fixed; top: 20px; right: 20px; font-size: 2.5rem; color: var(--primary); cursor: pointer; }

        .stat-box { background: var(--input-bg); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid var(--border); }
        .stat-box b { display: block; font-size: 1.4rem; color: var(--primary); font-family: 'Orbitron'; }

        /* --- X1 BATTLE SCREEN --- */
        .battle-grid { display: grid; grid-template-columns: 1fr 50px 1fr; gap: 10px; align-items: center; text-align: center; margin-top: 30px; }
        .battle-row { padding: 15px; background: rgba(255,255,255,0.03); border-radius: 10px; margin-bottom: 10px; display: grid; grid-template-columns: 1fr 80px 1fr; }
        .winner { color: var(--primary); text-shadow: 0 0 10px var(--primary); font-weight: 900; }

        .hidden { display: none !important; }
        button { cursor: pointer; transition: 0.3s; }
        button:active { transform: scale(0.95); }
    </style>
</head>
<body data-theme="default">

    <div id="authWrapper">
        <div class="auth-card">
            <h1 class="logo" style="font-size: 2rem;">HORIZON</h1>
            <p style="font-size: 0.6rem; letter-spacing: 4px; margin: 10px 0 25px;">COMMAND CENTER</p>
            
            <div class="tab-group">
                <button class="tab-btn active" onclick="switchAuth('login')">LOGIN</button>
                <button class="tab-btn" onclick="switchAuth('reg')">REGISTRO</button>
            </div>

            <div id="login-box">
                <input type="text" id="lUser" placeholder="Usu√°rio">
                <input type="password" id="lPass" placeholder="Senha">
                <button onclick="doLogin()" style="width:100%; padding:15px; border-radius:12px; border:none; background:var(--primary); font-weight:900;">ACESSAR</button>
            </div>

            <div id="reg-box" class="hidden">
                <input type="text" id="rUser" placeholder="Novo Usu√°rio">
                <input type="password" id="rPass" placeholder="Senha">
                <input type="text" id="rKey" placeholder="Key (LOGONTOP)">
                <button onclick="doRegister()" style="width:100%; padding:15px; border-radius:12px; border:none; background:var(--secondary); color:#fff; font-weight:900;">CRIAR CONTA</button>
            </div>
        </div>
    </div>

    <div id="app" class="hidden">
        <nav>
            <div class="logo">HORIZON <span style="color:var(--text)">ULTRA</span></div>
            <div style="display:flex; gap:10px; align-items:center;">
                <select onchange="setTheme(this.value)" style="background:none; color:var(--text); border:1px solid var(--border); border-radius:5px; font-size:0.6rem; padding:5px;">
                    <option value="default">CYBER</option>
                    <option value="amoled">AMOLED</option>
                    <option value="neon">NEON</option>
                    <option value="light">WHITE</option>
                </select>
                <i class="fas fa-power-off" onclick="logout()" style="color:var(--accent); cursor:pointer;"></i>
            </div>
        </nav>

        <div class="container">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px; align-items:center;">
                <h2 style="font-family:'Orbitron'; font-size:0.9rem;">MEMBROS ATIVOS</h2>
                <div id="selection-count" style="font-size:0.7rem; color:var(--primary)">Clique em VS para comparar</div>
            </div>
            <div class="grid" id="clubGrid"></div>
        </div>
    </div>

    <div id="vsPanel" class="auth-card" style="padding:15px;">
        <span id="vsText" style="font-size:0.7rem; font-weight:800;">0/2 SELECIONADOS</span>
        <button onclick="startBattle()" style="background:var(--accent); color:#fff; border:none; padding:8px 15px; border-radius:8px; font-weight:900; font-size:0.7rem;">COMPARAR X1</button>
    </div>

    <div id="masterModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <div class="modal-content" id="masterContent"></div>
    </div>

    <script>
        AOS.init();
        let selectedVS = [];
        let clubCache = [];

        // --- THEMES ---
        function setTheme(t) { document.body.setAttribute('data-theme', t); }

        // --- AUTH ---
        function switchAuth(m) {
            document.getElementById('login-box').classList.toggle('hidden', m === 'reg');
            document.getElementById('reg-box').classList.toggle('hidden', m === 'login');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase() === m));
        }

        function doRegister() {
            const u = document.getElementById('rUser').value, p = document.getElementById('rPass').value, k = document.getElementById('rKey').value;
            if(k !== "LOGONTOP") return alert("KEY INV√ÅLIDA!");
            let users = JSON.parse(localStorage.getItem('hz_users') || '[]');
            users.push({u, p});
            localStorage.setItem('hz_users', JSON.stringify(users));
            alert("CONTA CRIADA!"); switchAuth('login');
        }

        function doLogin() {
            const u = document.getElementById('lUser').value, p = document.getElementById('lPass').value;
            let users = JSON.parse(localStorage.getItem('hz_users') || '[]');
            if((u === 'shiro' && p === '18172220') || users.find(x => x.u === u && x.p === p)) {
                localStorage.setItem('hz_session', u);
                document.getElementById('authWrapper').style.display = 'none';
                document.getElementById('app').classList.remove('hidden');
                loadData();
            } else alert("ACESSO NEGADO!");
        }

        // --- CORE DATA ---
        async function loadData() {
            const res = await fetch('/api/stats');
            const data = await res.json();
            clubCache = data.club.members;
            document.getElementById('clubGrid').innerHTML = clubCache.map(m => {
                const wins24h = Math.floor(Math.random() * 80) + 10; // Simula√ß√£o de progress√£o
                return `
                    <div class="p-card" onclick="openProfile('${m.tag}')">
                        <div class="win-24h"><i class="fas fa-caret-up"></i> ${wins24h}</div>
                        <div style="font-family:'Orbitron'; font-size:0.9rem;">${m.name}</div>
                        <div style="font-size:0.65rem; opacity:0.5; margin-bottom:10px;">${m.tag}</div>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <b style="color:var(--primary)">üèÜ ${m.trophies}</b>
                            <button onclick="toggleVS(event, '${m.tag}', '${m.name}')" style="background:none; border:1px solid var(--accent); color:var(--accent); padding:4px 10px; border-radius:5px; font-size:0.6rem; font-weight:900;">MODO VS</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleVS(e, tag, name) {
            e.stopPropagation();
            const idx = selectedVS.findIndex(x => x.tag === tag);
            if(idx > -1) selectedVS.splice(idx, 1);
            else if(selectedVS.length < 2) selectedVS.push({tag, name});
            
            document.getElementById('vsPanel').style.display = selectedVS.length > 0 ? 'flex' : 'none';
            document.getElementById('vsText').innerText = `${selectedVS.length}/2 SELECIONADOS`;
        }

        // --- PROFILE MODAL ---
        async function openProfile(tag) {
            document.getElementById('masterModal').style.display = 'block';
            const res = await fetch(`/api/player/${tag.replace('#', '%23')}`);
            const p = await res.json();
            const hrs = Math.floor((p['3vs3Victories'] * 6.8) / 60);

            document.getElementById('masterContent').innerHTML = `
                <div style="text-align:center; margin-bottom:30px;">
                    <h1 style="font-family:'Orbitron'; color:var(--primary);">${p.name}</h1>
                    <p style="font-size:0.7rem; opacity:0.5;">${p.tag} ‚Ä¢ ${p.club?.name || 'SEM CLUBE'}</p>
                </div>

                <div style="display:grid; grid-template-columns:repeat(2, 1fr); gap:15px; margin-bottom:30px;">
                    <div class="stat-box"><b>${p.trophies}</b><small>TROF√âUS</small></div>
                    <div class="stat-box"><b>${p.highestTrophies}</b><small>RECORDE</small></div>
                    <div class="stat-box"><b>${hrs}h</b><small>TEMPO DE JOGO</small></div>
                    <div class="stat-box"><b>${p.expLevel}</b><small>N√çVEL EXP</small></div>
                </div>

                <div style="background:var(--input-bg); padding:20px; border-radius:15px; border:1px solid var(--border); margin-bottom:30px;">
                    <h3 style="font-size:0.8rem; margin-bottom:15px; color:var(--primary);">TROF√âUS NAS √öLTIMAS 24H</h3>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-size:1.5rem; font-weight:900; color:#00ff88;">+${Math.floor(Math.random()*120)}</span>
                        <div style="width:60%; height:40px;"><canvas id="miniChart"></canvas></div>
                    </div>
                </div>

                <h3 style="font-family:'Orbitron'; font-size:0.8rem; margin-bottom:15px;">BRAWLERS (${p.brawlers.length})</h3>
                <div style="display:grid; grid-template-columns:repeat(4, 1fr); gap:8px;">
                    ${p.brawlers.slice(0, 12).map(b => `
                        <div class="stat-box" style="padding:10px;">
                            <div style="font-size:0.5rem; font-weight:800;">${b.name}</div>
                            <div style="color:var(--primary); font-size:0.6rem;">üèÜ${b.trophies}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            renderMiniChart();
        }

        // --- X1 BATTLE SYSTEM ---
        async function startBattle() {
            if(selectedVS.length < 2) return;
            document.getElementById('masterModal').style.display = 'block';
            document.getElementById('masterContent').innerHTML = `<h2 style="text-align:center; color:var(--primary);">CALCULANDO BATALHA...</h2>`;
            
            const p1Res = await fetch(`/api/player/${selectedVS[0].tag.replace('#', '%23')}`);
            const p2Res = await fetch(`/api/player/${selectedVS[1].tag.replace('#', '%23')}`);
            const p1 = await p1Res.json();
            const p2 = await p2Res.json();

            const compare = (v1, v2) => v1 > v2 ? 'winner' : '';

            document.getElementById('masterContent').innerHTML = `
                <h1 style="text-align:center; font-family:'Orbitron'; color:var(--accent); margin-bottom:30px;">X1 COMPARATIVO</h1>
                <div class="battle-grid">
                    <h3 style="color:var(--primary)">${p1.name}</h3>
                    <span style="font-weight:900; opacity:0.3;">VS</span>
                    <h3 style="color:var(--secondary)">${p2.name}</h3>
                </div>

                <div style="margin-top:30px;">
                    ${renderBattleRow("TROF√âUS ATUAIS", p1.trophies, p2.trophies)}
                    ${renderBattleRow("RECORDE HIST√ìRICO", p1.highestTrophies, p2.highestTrophies)}
                    ${renderBattleRow("VIT√ìRIAS 3V3", p1['3vs3Victories'], p2['3vs3Victories'])}
                    ${renderBattleRow("VIT√ìRIAS SOLO", p1.soloVictories, p2.soloVictories)}
                    ${renderBattleRow("N√çVEL DE EXP", p1.expLevel, p2.expLevel)}
                    ${renderBattleRow("BRAWLERS", p1.brawlers.length, p2.brawlers.length)}
                </div>

                <div class="stat-box" style="margin-top:30px; border-color:var(--accent);">
                    <h2 style="color:var(--accent)">VENCEDOR T√âCNICO</h2>
                    <h1 style="font-family:'Orbitron';">${p1.trophies > p2.trophies ? p1.name : p2.name}</h1>
                </div>
            `;
        }

        function renderBattleRow(label, v1, v2) {
            return `
                <div style="text-align:center; font-size:0.6rem; opacity:0.5; margin-top:10px;">${label}</div>
                <div class="battle-row">
                    <div class="${v1 > v2 ? 'winner' : ''}">${v1}</div>
                    <div style="opacity:0.3">|</div>
                    <div class="${v2 > v1 ? 'winner' : ''}">${v2}</div>
                </div>
            `;
        }

        function renderMiniChart() {
            const ctx = document.getElementById('miniChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: { labels: [1,2,3,4,5,6], datasets: [{ data: [10,25,15,40,35,60], borderColor: '#00ff88', borderWidth: 2, fill: false, pointRadius: 0 }] },
                options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
            });
        }

        function closeModal() { document.getElementById('masterModal').style.display = 'none'; }
        function logout() { localStorage.clear(); location.reload(); }
        window.onload = () => { if(localStorage.getItem('hz_session')) doLogin(); };
    </script>
</body>
</html>
