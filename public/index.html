<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Horizon Ultra | Command Center</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Orbitron:wght@700&family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <style>
        :root {
            --primary: #00f2ff;
            --accent: #bc13fe; 
            --bg: #020617;
            --card: rgba(15, 23, 42, 0.6); 
            --text: #f8fafc;
            --border: rgba(255, 255, 255, 0.1);
        }

        [data-theme="amoled"] { --bg: #000; --card: #0a0a0a; --primary: #fff; }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); overflow-x: hidden; min-height: 100vh; padding-bottom: 80px; }

        .glass { background: var(--card); backdrop-filter: blur(12px); border: 1px solid var(--border); border-radius: 20px; }
        
        /* Navigation */
        nav { position: fixed; top: 0; width: 100%; z-index: 1000; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(2, 6, 23, 0.8); border-bottom: 1px solid var(--border); }
        .logo { font-family: 'Rajdhani'; font-size: 1.5rem; font-weight: 700; color: var(--primary); letter-spacing: 2px; }

        /* Bottom Tab Bar */
        .tab-bar { position: fixed; bottom: 0; width: 100%; height: 70px; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid var(--border); z-index: 2000; }
        .tab-item { color: #64748b; text-align: center; font-size: 0.7rem; cursor: pointer; transition: 0.3s; flex: 1; }
        .tab-item.active { color: var(--primary); }
        .tab-item i { font-size: 1.2rem; display: block; margin-bottom: 4px; }

        /* Sections */
        .section { display: none; padding: 100px 20px 20px; max-width: 1200px; margin: 0 auto; }
        .section.active { display: block; animation: fadeIn 0.5s ease; }

        /* Player Cards */
        .p-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .p-card { padding: 20px; cursor: pointer; border: 1px solid var(--border); transition: 0.3s; }
        .p-card:hover { border-color: var(--primary); transform: translateY(-3px); }

        /* X1 System */
        .x1-container { display: flex; flex-direction: column; gap: 20px; align-items: center; }
        .x1-select-box { width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        select { background: #0f172a; color: #fff; padding: 12px; border: 1px solid var(--border); border-radius: 10px; width: 100%; }

        /* Modal */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 3000; padding: 20px; overflow-y: auto; }
        .modal-content { max-width: 900px; margin: 20px auto; padding: 30px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <nav>
        <div class="logo">HORIZON <span style="color:#fff">PRO</span></div>
        <div id="userLabel" style="font-weight:900; font-size:0.7rem;">DASHBOARD</div>
    </nav>

    <section id="clube" class="section active">
        <h2 style="font-family:'Rajdhani'; margin-bottom: 20px;">MEMBROS DO CLUBE</h2>
        <div class="p-grid" id="clubGrid"></div>
    </section>

    <section id="modoX1" class="section">
        <h2 style="font-family:'Rajdhani'; margin-bottom: 20px; text-align: center;">MODO X1 COMPARATIVO</h2>
        <div class="x1-container">
            <div class="x1-select-box">
                <select id="select1" onchange="updateX1()"><option>Escolha Jogador 1</option></select>
                <select id="select2" onchange="updateX1()"><option>Escolha Jogador 2</option></select>
            </div>
            <div id="x1Result" style="width: 100%;" class="glass">
                <p style="text-align: center; padding: 50px; opacity: 0.5;">Selecione dois jogadores para comparar</p>
            </div>
        </div>
    </section>

    <section id="logs" class="section">
        <h2 style="font-family:'Rajdhani'; margin-bottom: 20px;">SYSTEM LOGS</h2>
        <div id="logConsole" style="background:#000; padding:20px; border-radius:10px; font-family:monospace; color:#00ff88; height: 400px; overflow-y: auto;"></div>
    </section>

    <div class="tab-bar">
        <div class="tab-item active" onclick="switchTab('clube', this)">
            <i class="fas fa-users"></i>Clube
        </div>
        <div class="tab-item" onclick="switchTab('modoX1', this)">
            <i class="fas fa-bolt"></i>Modo X1
        </div>
        <div class="tab-item" onclick="switchTab('logs', this)">
            <i class="fas fa-terminal"></i>Logs
        </div>
    </div>

    <div id="playerModal" class="modal">
        <div class="modal-content glass" id="modalData">
            </div>
    </div>

    <script>
        let clubCache = [];
        let chartInst = null;

        // Navega√ß√£o
        function switchTab(id, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        // Carregar Dados
        async function loadApp() {
            const res = await fetch('/api/stats');
            const data = await res.json();
            clubCache = data.club.members;
            
            // Renderiza Grid do Clube
            document.getElementById('clubGrid').innerHTML = clubCache.map(m => `
                <div class="p-card glass" onclick="openProfile('${m.tag}')">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <b>${m.name}</b>
                        <span style="color:var(--primary); font-weight:900;">üèÜ ${m.trophies}</span>
                    </div>
                </div>
            `).join('');

            // Popula Selects do X1
            const options = clubCache.map(m => `<option value="${m.tag}">${m.name}</option>`).join('');
            document.getElementById('select1').innerHTML += options;
            document.getElementById('select2').innerHTML += options;
        }

        // Perfil Detalhado
        async function openProfile(tag) {
            document.getElementById('playerModal').style.display = 'block';
            document.getElementById('modalData').innerHTML = "<h1>CARREGANDO...</h1>";
            
            const res = await fetch(`/api/player/${tag.replace('#', '%23')}`);
            const p = await res.json();
            
            document.getElementById('modalData').innerHTML = `
                <div style="display:flex; justify-content:space-between;">
                    <h1 style="color:var(--primary); font-family:'Rajdhani'">${p.name}</h1>
                    <button onclick="closeModal()" style="background:none; border:none; color:#fff; font-size:2rem; cursor:pointer;">&times;</button>
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:20px;">
                    <div class="glass" style="padding:15px;">
                        <p style="font-size:0.7rem; opacity:0.5;">TROF√âUS DI√ÅRIOS (SIMULADO)</p>
                        <canvas id="dailyChart"></canvas>
                    </div>
                    <div class="glass" style="padding:15px;">
                        <p>M√°ximo: <b>${p.highestTrophies}</b></p>
                        <p>Vit√≥rias 3v3: <b>${p['3vs3Victories']}</b></p>
                        <p>N√≠vel Exp: <b>${p.expLevel}</b></p>
                    </div>
                </div>
                <h3 style="margin-top:20px;">BRAWLERS (${p.brawlers.length})</h3>
                <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap:10px; margin-top:10px;">
                    ${p.brawlers.slice(0,12).map(b => `<div class="glass" style="padding:10px; font-size:0.7rem; text-align:center;">${b.name}<br><b style="color:#ffd700">üèÜ${b.trophies}</b></div>`).join('')}
                </div>
            `;
            
            // Gr√°fico de Trof√©us
            const ctx = document.getElementById('dailyChart');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab', 'Dom'],
                    datasets: [{ label: 'Trof√©us', data: [p.trophies-50, p.trophies-30, p.trophies-40, p.trophies-10, p.trophies], borderColor: '#00f2ff', tension: 0.4 }]
                },
                options: { plugins: { legend: { display: false } } }
            });
        }

        // Sistema X1
        async function updateX1() {
            const t1 = document.getElementById('select1').value;
            const t2 = document.getElementById('select2').value;
            if(t1 === t2 || t1.startsWith('Escolha') || t2.startsWith('Escolha')) return;

            const [p1, p2] = await Promise.all([
                fetch(`/api/player/${t1.replace('#', '%23')}`).then(r => r.json()),
                fetch(`/api/player/${t2.replace('#', '%23')}`).then(r => r.json())
            ]);

            document.getElementById('x1Result').innerHTML = `
                <div style="display:grid; grid-template-columns: 1fr 50px 1fr; padding:30px; text-align:center; align-items:center;">
                    <div><h2 style="color:var(--primary)">${p1.name}</h2><p>üèÜ ${p1.trophies}</p></div>
                    <h1 style="color:var(--accent)">VS</h1>
                    <div><h2 style="color:var(--primary)">${p2.name}</h2><p>üèÜ ${p2.trophies}</p></div>
                </div>
                <div style="padding:20px; border-top:1px solid var(--border); text-align:center;">
                    <p>Vencedor T√©cnico: <b style="color:var(--primary)">${p1.trophies > p2.trophies ? p1.name : p2.name}</b></p>
                </div>
            `;
        }

        function closeModal() { document.getElementById('playerModal').style.display = 'none'; }
        
        window.onload = loadApp;
    </script>
</body>
</html>
